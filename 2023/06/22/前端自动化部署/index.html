<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="soxio"><meta name="copyright" content="soxio"><meta name="generator" content="Hexo 6.1.0"><meta name="theme" content="hexo-theme-yun"><title>前端自动化部署 | 知易行难的小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link class="aplayer-style-marker" rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.css"><script class="aplayer-script-marker" src="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.js" defer></script><script class="meting-script-marker" src="https://cdn.jsdelivr.net/npm/meting@1/dist/Meting.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/pjax@latest/pjax.min.js" defer></script><script src="/js/pjax.js" defer></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="icon" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"ajax404.tk","root":"/","title":["众","里","寻","他","千","百","度"],"version":"1.6.2","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn?c=i","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><link rel="alternate" href="/atom.xml" title="知易行难的小站" type="application/atom+xml"><meta name="description" content="同步服务器时间yum install -y ntp systemctl enable ntpd systemctl start ntpd  docker安装1. 安装依赖yum install -y yum-utils device-mapper-persistent-data lvm2  2. 设置yum源#官方源（慢） yum-config-manager --add-repo http:&amp;#">
<meta property="og:type" content="article">
<meta property="og:title" content="前端自动化部署">
<meta property="og:url" content="https://ajax404.tk/2023/06/22/%E5%89%8D%E7%AB%AF%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/index.html">
<meta property="og:site_name" content="知易行难的小站">
<meta property="og:description" content="同步服务器时间yum install -y ntp systemctl enable ntpd systemctl start ntpd  docker安装1. 安装依赖yum install -y yum-utils device-mapper-persistent-data lvm2  2. 设置yum源#官方源（慢） yum-config-manager --add-repo http:&amp;#">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-06-22T11:39:45.371Z">
<meta property="article:modified_time" content="2023-07-28T07:25:43.011Z">
<meta property="article:author" content="soxio">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="nginx">
<meta property="article:tag" content="gitlab">
<meta property="article:tag" content="gitlab-runner">
<meta name="twitter:card" content="summary"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="soxio"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="soxio"></a><div class="site-author-name"><a href="/about/">soxio</a></div><span class="site-name">知易行难的小站</span><sub class="site-subtitle">All at sea</sub><div class="site-desciption">月遇丛云，花遇和风</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">21</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">17</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">27</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=1028934836&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/soxio" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:langhualiuyue@gmail.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=65625355" title="网易云音乐" target="_blank" style="color:#C10D0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/8180010" title="哔哩哔哩动画" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%97%B6%E9%97%B4"><span class="toc-number">1.</span> <span class="toc-text">同步服务器时间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker"><span class="toc-number">2.</span> <span class="toc-text">docker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.</span> <span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="toc-number">2.1.1.</span> <span class="toc-text">1. 安装依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%AE%BE%E7%BD%AEyum%E6%BA%90"><span class="toc-number">2.1.2.</span> <span class="toc-text">2. 设置yum源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%AE%89%E8%A3%85%E6%9C%80%E6%96%B0docker%E7%A4%BE%E5%8C%BA%E7%89%88"><span class="toc-number">2.1.3.</span> <span class="toc-text">3. 安装最新docker社区版</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BF%AE%E6%94%B9%E4%BB%93%E5%BA%93%E9%95%9C%E5%83%8F%E6%BA%90-%E5%8F%AF%E9%80%89"><span class="toc-number">2.1.4.</span> <span class="toc-text">4.修改仓库镜像源(可选)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%90%AF%E5%8A%A8docker"><span class="toc-number">2.1.5.</span> <span class="toc-text">5. 启动docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81docker%E5%91%BD%E4%BB%A4-%E6%95%99%E7%A8%8B%E5%8F%AF%E7%95%A5%E8%BF%87"><span class="toc-number">2.1.6.</span> <span class="toc-text">常见docker命令(教程可略过)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.</span> <span class="toc-text">离线安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%B8%8B%E8%BD%BD%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E5%8C%85"><span class="toc-number">2.2.1.</span> <span class="toc-text">1. 下载离线安装包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%B0%86%E5%AE%89%E8%A3%85%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A"><span class="toc-number">2.2.2.</span> <span class="toc-text">2. 将安装文件上传到服务器上</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.3.</span> <span class="toc-text">3. 解压文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%B0%86%E8%A7%A3%E5%8E%8B%E5%87%BA%E6%9D%A5%E7%9A%84docker%E6%96%87%E4%BB%B6%E5%A4%8D%E5%88%B6%E5%88%B0-usr-bin-%E7%9B%AE%E5%BD%95%E4%B8%8B"><span class="toc-number">2.2.4.</span> <span class="toc-text">4. 将解压出来的docker文件复制到 &#x2F;usr&#x2F;bin&#x2F; 目录下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%88%9B%E5%BB%BAdocker-service%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.5.</span> <span class="toc-text">5. 创建docker.service文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.6.</span> <span class="toc-text">6. 复制配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E7%BB%99docker-service%E6%96%87%E4%BB%B6%E6%B7%BB%E5%8A%A0%E6%89%A7%E8%A1%8C%E6%9D%83%E9%99%90"><span class="toc-number">2.2.7.</span> <span class="toc-text">7. 给docker.service文件添加执行权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.8.</span> <span class="toc-text">8. 重新加载配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E5%90%AF%E5%8A%A8"><span class="toc-number">2.2.9.</span> <span class="toc-text">9. 启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF"><span class="toc-number">2.2.10.</span> <span class="toc-text">10. 开机自启</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-%E6%9F%A5%E7%9C%8Bdocker%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81"><span class="toc-number">2.2.11.</span> <span class="toc-text">11. 查看docker运行状态</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx"><span class="toc-number">3.</span> <span class="toc-text">nginx</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">3.1.</span> <span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"><span class="toc-number">3.1.1.</span> <span class="toc-text">1. 拉取镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F"><span class="toc-number">3.1.2.</span> <span class="toc-text">2. 查看镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8"><span class="toc-number">3.1.3.</span> <span class="toc-text">3. 创建容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%9F%A5%E7%9C%8B%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-number">3.1.4.</span> <span class="toc-text">4. 查看运行的容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%AE%BF%E4%B8%BB%E5%88%9B%E5%BB%BA%E6%8C%82%E8%BD%BD%E7%9B%AE%E5%BD%95%EF%BC%88nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%8D%E9%80%82%E5%90%88%E6%94%BE%E5%9C%A8%E5%AE%B9%E5%99%A8%E9%87%8C%EF%BC%89"><span class="toc-number">3.1.5.</span> <span class="toc-text">5. 宿主创建挂载目录（nginx配置文件不适合放在容器里）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%B0%86%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A4%8D%E5%88%B6%E5%88%B0%E5%AE%BF%E4%B8%BB%E5%86%85"><span class="toc-number">3.1.6.</span> <span class="toc-text">6. 将容器内的配置文件复制到宿主内</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E7%A7%BB%E9%99%A4%E5%AE%B9%E5%99%A8"><span class="toc-number">3.1.7.</span> <span class="toc-text">7. 移除容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E9%87%8D%E6%96%B0%E7%94%9F%E6%88%90%E5%AE%B9%E5%99%A8%E5%B9%B6%E6%B7%BB%E5%8A%A0%E6%98%A0%E5%B0%84"><span class="toc-number">3.1.8.</span> <span class="toc-text">8. 重新生成容器并添加映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E7%AB%AF%E5%8F%A3%E6%94%BE%E8%A1%8C-%E5%8F%AF%E9%80%89"><span class="toc-number">3.1.9.</span> <span class="toc-text">9. 端口放行(可选)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-nginx%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.1.10.</span> <span class="toc-text">10. nginx完整配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-nginx%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE"><span class="toc-number">3.1.11.</span> <span class="toc-text">11. nginx代理设置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gitLab"><span class="toc-number">4.</span> <span class="toc-text">gitLab</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F-1"><span class="toc-number">4.1.</span> <span class="toc-text">1. 拉取镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8"><span class="toc-number">4.2.</span> <span class="toc-text">2. 创建容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">4.3.</span> <span class="toc-text">3. 修改配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AF%86%E7%A0%81"><span class="toc-number">4.4.</span> <span class="toc-text">4. 初始化密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%8F%90%E4%BA%A4%E7%8E%B0%E6%9C%89%E9%A1%B9%E7%9B%AE"><span class="toc-number">4.5.</span> <span class="toc-text">5. 提交现有项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%88%A0%E9%99%A4%E9%A1%B9%E7%9B%AE%E5%90%8E%E9%A1%B5%E9%9D%A2%E4%BB%8D%E7%84%B6%E5%AD%98%E5%9C%A8"><span class="toc-number">4.6.</span> <span class="toc-text">6. 删除项目后页面仍然存在</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gitlab-runner"><span class="toc-number">5.</span> <span class="toc-text">gitlab-runner</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F-2"><span class="toc-number">5.1.</span> <span class="toc-text">1. 拉取镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8-1"><span class="toc-number">5.2.</span> <span class="toc-text">2. 创建容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B3%A8%E5%86%8Crunner"><span class="toc-number">5.3.</span> <span class="toc-text">3. 注册runner</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%85%8D%E7%BD%AEgitlab-runner-%E6%98%A0%E5%B0%84%E5%9C%B0%E5%9D%80"><span class="toc-number">5.4.</span> <span class="toc-text">4. 配置gitlab-runner 映射地址</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">5.4.0.1.</span> <span class="toc-text">完整配置文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-gitlab-ci-yml-%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">5.5.</span> <span class="toc-text">5. .gitlab-ci.yml 文件配置</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://ajax404.tk/2023/06/22/%E5%89%8D%E7%AB%AF%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="soxio"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="知易行难的小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">前端自动化部署</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2023-06-22 19:39:45" itemprop="dateCreated datePublished" datetime="2023-06-22T19:39:45+08:00">2023-06-22</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="修改时间：2023-07-28 15:25:43" itemprop="dateModified" datetime="2023-07-28T15:25:43+08:00">2023-07-28</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-file-word-line"></use></svg></span> <span title="本文字数">2.3k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-timer-line"></use></svg></span> <span title="阅读时长">11m</span></span></span><span class="leancloud_visitors" id="/2023/06/22/%E5%89%8D%E7%AB%AF%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/" data-flag-title="前端自动化部署"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span class="leancloud-visitors-count"></span></span></span><span class="post-meta-divider">-</span><a href="#comment"><span class="post-meta-item-icon" title="评论数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-chat-3-line"></use></svg> <span class="waline-comment-count" id="/2023/06/22/%E5%89%8D%E7%AB%AF%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/"></span></span></a><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E8%BF%90%E7%BB%B4/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">运维</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/docker/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">docker</span></a><a class="tag-item" href="/tags/nginx/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">nginx</span></a><a class="tag-item" href="/tags/gitlab/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">gitlab</span></a><a class="tag-item" href="/tags/gitlab-runner/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">gitlab-runner</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h2 id="同步服务器时间"><a href="#同步服务器时间" class="headerlink" title="同步服务器时间"></a>同步服务器时间</h2><pre class="language-none"><code class="language-none">yum install -y ntp
systemctl enable ntpd
systemctl start ntpd</code></pre>

<h2 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h4 id="1-安装依赖"><a href="#1-安装依赖" class="headerlink" title="1. 安装依赖"></a>1. 安装依赖</h4><pre class="language-none"><code class="language-none">yum install -y yum-utils device-mapper-persistent-data lvm2</code></pre>

<h4 id="2-设置yum源"><a href="#2-设置yum源" class="headerlink" title="2. 设置yum源"></a>2. 设置yum源</h4><pre class="language-none"><code class="language-none">#官方源（慢）
yum-config-manager --add-repo http:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo
#阿里源
yum-config-manager --add-repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo
#清华大学源
yum-config-manager --add-repo https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</code></pre>

<h4 id="3-安装最新docker社区版"><a href="#3-安装最新docker社区版" class="headerlink" title="3. 安装最新docker社区版"></a>3. 安装最新docker社区版</h4><pre class="language-none"><code class="language-none">#最新的docker社区版
yum install -y docker-ce docker-ce-cli containerd.io</code></pre>

<h4 id="4-修改仓库镜像源-可选"><a href="#4-修改仓库镜像源-可选" class="headerlink" title="4.修改仓库镜像源(可选)"></a>4.修改仓库镜像源(可选)</h4><pre class="language-none"><code class="language-none"># 查看镜像源地址
https:&#x2F;&#x2F;cr.console.aliyun.com&#x2F;cn-beijing&#x2F;instances&#x2F;mirrors
# 修改配置文件
vi &#x2F;etc&#x2F;docker&#x2F;daemon.json
# 配置文件信息
&#123;
  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;m0jtr3eq.mirror.aliyuncs.com&quot;]
&#125;
# 重启生效
systemctl daemon-reload
systemctl restart docker</code></pre>



<h4 id="5-启动docker"><a href="#5-启动docker" class="headerlink" title="5. 启动docker"></a>5. 启动docker</h4><pre class="language-none"><code class="language-none">#重启docker
systemctl restart docker
#设置开机启动
systemctl enable docker</code></pre>

<h4 id="常见docker命令-教程可略过"><a href="#常见docker命令-教程可略过" class="headerlink" title="常见docker命令(教程可略过)"></a>常见docker命令(教程可略过)</h4><pre class="language-none"><code class="language-none"># 进入容器内部
docker exec -it 容器名称 &#x2F;bin&#x2F;bash
# 重启容器
docker restart 名称或id

# 宿主文件复制到容器 
dcoker cp 本机文件名或者文件路径 容器ID:容器内的路径
# 容器文件复制到宿主
dcoker cp ID全称:容器文件路径 本地路径

# 保存镜像
docker save -o &lt;保存路径&#x2F;文件名.tar&gt; &lt;镜像名称:标签&gt;
# 加载镜像
docker load -i &lt;保存路径&#x2F;文件名.tar&gt;</code></pre>

<h3 id="离线安装"><a href="#离线安装" class="headerlink" title="离线安装"></a>离线安装</h3><h4 id="1-下载离线安装包"><a href="#1-下载离线安装包" class="headerlink" title="1. 下载离线安装包"></a>1. 下载离线安装包</h4><pre class="language-none"><code class="language-none">https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;static&#x2F;stable&#x2F;x86_64&#x2F;</code></pre>

<h4 id="2-将安装文件上传到服务器上"><a href="#2-将安装文件上传到服务器上" class="headerlink" title="2. 将安装文件上传到服务器上"></a>2. 将安装文件上传到服务器上</h4><h4 id="3-解压文件"><a href="#3-解压文件" class="headerlink" title="3. 解压文件"></a>3. 解压文件</h4><pre class="language-none"><code class="language-none">tar -zxvf docker-18.06.3-ce.tgz</code></pre>

<h4 id="4-将解压出来的docker文件复制到-usr-bin-目录下"><a href="#4-将解压出来的docker文件复制到-usr-bin-目录下" class="headerlink" title="4. 将解压出来的docker文件复制到 /usr/bin/ 目录下"></a>4. 将解压出来的docker文件复制到 /usr/bin/ 目录下</h4><pre class="language-none"><code class="language-none">cp docker&#x2F;* &#x2F;usr&#x2F;bin&#x2F;</code></pre>

<h4 id="5-创建docker-service文件"><a href="#5-创建docker-service文件" class="headerlink" title="5. 创建docker.service文件"></a>5. 创建docker.service文件</h4><pre class="language-none"><code class="language-none">vi &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;docker.service </code></pre>

<h4 id="6-复制配置文件"><a href="#6-复制配置文件" class="headerlink" title="6. 复制配置文件"></a>6. 复制配置文件</h4><pre class="language-none"><code class="language-none">[Unit]
Description&#x3D;Docker Application Container Engine
Documentation&#x3D;https:&#x2F;&#x2F;docs.docker.com
After&#x3D;network-online.target firewalld.service
Wants&#x3D;network-online.target

[Service]
Type&#x3D;notify
# the default is not to use systemd for cgroups because the delegate issues still
# exists and systemd currently does not support the cgroup feature set required
# for containers run by docker
ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;dockerd --selinux-enabled&#x3D;false --insecure-registry&#x3D;192.168.200.128
ExecReload&#x3D;&#x2F;bin&#x2F;kill -s HUP $MAINPID
# Having non-zero Limit*s causes performance problems due to accounting overhead
# in the kernel. We recommend using cgroups to do container-local accounting.
LimitNOFILE&#x3D;infinity
LimitNPROC&#x3D;infinity
LimitCORE&#x3D;infinity
# Uncomment TasksMax if your systemd version supports it.
# Only systemd 226 and above support this version.
#TasksMax&#x3D;infinity
TimeoutStartSec&#x3D;0
# set delegate yes so that systemd does not reset the cgroups of docker containers
Delegate&#x3D;yes
# kill only the docker process, not all processes in the cgroup
KillMode&#x3D;process
# restart the docker process if it exits prematurely
Restart&#x3D;on-failure
StartLimitBurst&#x3D;3
StartLimitInterval&#x3D;60s

[Install]
WantedBy&#x3D;multi-user.target
</code></pre>

<h4 id="7-给docker-service文件添加执行权限"><a href="#7-给docker-service文件添加执行权限" class="headerlink" title="7. 给docker.service文件添加执行权限"></a>7. 给docker.service文件添加执行权限</h4><pre class="language-none"><code class="language-none">chmod 777 &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;docker.service</code></pre>

<h4 id="8-重新加载配置文件"><a href="#8-重新加载配置文件" class="headerlink" title="8. 重新加载配置文件"></a>8. 重新加载配置文件</h4><pre class="language-none"><code class="language-none">systemctl daemon-reload</code></pre>

<h4 id="9-启动"><a href="#9-启动" class="headerlink" title="9. 启动"></a>9. 启动</h4><pre class="language-none"><code class="language-none">systemctl start docker</code></pre>

<h4 id="10-开机自启"><a href="#10-开机自启" class="headerlink" title="10. 开机自启"></a>10. 开机自启</h4><pre class="language-none"><code class="language-none">systemctl enable docker.service</code></pre>

<h4 id="11-查看docker运行状态"><a href="#11-查看docker运行状态" class="headerlink" title="11. 查看docker运行状态"></a>11. 查看docker运行状态</h4><pre class="language-none"><code class="language-none">systemctl status docker</code></pre>



<h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><h4 id="1-拉取镜像"><a href="#1-拉取镜像" class="headerlink" title="1. 拉取镜像"></a>1. 拉取镜像</h4><pre class="language-none"><code class="language-none"># 指定版本为 docker pull nginx:xx.xx
docker pull nginx</code></pre>

<h4 id="2-查看镜像"><a href="#2-查看镜像" class="headerlink" title="2. 查看镜像"></a>2. 查看镜像</h4><pre class="language-none"><code class="language-none">docker images</code></pre>

<h4 id="3-创建容器"><a href="#3-创建容器" class="headerlink" title="3. 创建容器"></a>3. 创建容器</h4><pre class="language-none"><code class="language-none">docker run --name nginx -p 80:80 -d nginx</code></pre>

<h4 id="4-查看运行的容器"><a href="#4-查看运行的容器" class="headerlink" title="4. 查看运行的容器"></a>4. 查看运行的容器</h4><pre class="language-none"><code class="language-none">docker ps</code></pre>

<h4 id="5-宿主创建挂载目录（nginx配置文件不适合放在容器里）"><a href="#5-宿主创建挂载目录（nginx配置文件不适合放在容器里）" class="headerlink" title="5. 宿主创建挂载目录（nginx配置文件不适合放在容器里）"></a>5. 宿主创建挂载目录（nginx配置文件不适合放在容器里）</h4><pre class="language-none"><code class="language-none"># 创建挂载目录
mkdir -p &#x2F;home&#x2F;nginx&#x2F;conf
mkdir -p &#x2F;home&#x2F;nginx&#x2F;log
mkdir -p &#x2F;home&#x2F;nginx&#x2F;html</code></pre>

<h4 id="6-将容器内的配置文件复制到宿主内"><a href="#6-将容器内的配置文件复制到宿主内" class="headerlink" title="6. 将容器内的配置文件复制到宿主内"></a>6. 将容器内的配置文件复制到宿主内</h4><pre class="language-none"><code class="language-none"># 将容器nginx配置文件复制到宿主机
docker cp nginx:&#x2F;etc&#x2F;nginx&#x2F;nginx.conf &#x2F;home&#x2F;nginx&#x2F;conf&#x2F;nginx.conf
docker cp nginx:&#x2F;etc&#x2F;nginx&#x2F;conf.d &#x2F;home&#x2F;nginx&#x2F;conf&#x2F;conf.d
docker cp nginx:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html &#x2F;home&#x2F;nginx&#x2F;</code></pre>

<h4 id="7-移除容器"><a href="#7-移除容器" class="headerlink" title="7. 移除容器"></a>7. 移除容器</h4><pre class="language-none"><code class="language-none"># 关闭容器
docker stop nginx
# 删除容器
docker rm nginx</code></pre>

<h4 id="8-重新生成容器并添加映射"><a href="#8-重新生成容器并添加映射" class="headerlink" title="8. 重新生成容器并添加映射"></a>8. 重新生成容器并添加映射</h4><pre class="language-none"><code class="language-none">docker run -d -p 80:80 --name nginx --restart always -v &#x2F;home&#x2F;nginx&#x2F;conf&#x2F;nginx.conf:&#x2F;etc&#x2F;nginx&#x2F;nginx.conf -v &#x2F;home&#x2F;nginx&#x2F;conf&#x2F;conf.d:&#x2F;etc&#x2F;nginx&#x2F;conf.d -v &#x2F;home&#x2F;nginx&#x2F;log:&#x2F;var&#x2F;log&#x2F;nginx -v &#x2F;home&#x2F;nginx&#x2F;html:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html nginx</code></pre>

<h4 id="9-端口放行-可选"><a href="#9-端口放行-可选" class="headerlink" title="9. 端口放行(可选)"></a>9. 端口放行(可选)</h4><blockquote>
<p>docker容器映射端口时会自动放行</p>
</blockquote>
<pre class="language-none"><code class="language-none"># 放行指定端口
firewall-cmd --zone&#x3D;public --add-port&#x3D;8080&#x2F;tcp --permanent
# 重启防火墙生效
firewall-cmd --reload
# 查看放行的端口
firewall-cmd --list-ports
# 删除指定端口
firewall-cmd --zone&#x3D;public --remove-port&#x3D;8080&#x2F;tcp --permanent</code></pre>



<h4 id="10-nginx完整配置文件"><a href="#10-nginx完整配置文件" class="headerlink" title="10. nginx完整配置文件"></a>10. nginx完整配置文件</h4><blockquote>
<p>注意：如果存在相同配置块，nginx.conf 会被引入的default.conf所覆盖，解决history刷新404问题建议在default.conf里修改</p>
</blockquote>
<pre class="language-nginx" data-language="nginx"><code class="language-nginx">
    <span class="token directive"><span class="token keyword">include</span>       /etc/nginx/mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span>  application/octet-stream</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">user</span>  nginx</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_processes</span>  auto</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">error_log</span>  /var/log/nginx/error.log notice</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">pid</span>        /var/run/nginx.pid</span><span class="token punctuation">;</span>


<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">worker_connections</span>  <span class="token number">1024</span></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">include</span>       /etc/nginx/mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span>  application/octet-stream</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">log_format</span>  main  <span class="token string">'<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local]</span> "<span class="token variable">$request</span>" '</span>
                      <span class="token string">'<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> "<span class="token variable">$http_referer</span>" '</span>
                      <span class="token string">'"<span class="token variable">$http_user_agent</span>" "<span class="token variable">$http_x_forwarded_for</span>"'</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">access_log</span>  /var/log/nginx/access.log  main</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">sendfile</span>        <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token directive"><span class="token keyword">keepalive_timeout</span>  <span class="token number">65</span></span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>

    <span class="token directive"><span class="token keyword">include</span> /etc/nginx/conf.d/*.conf</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
        <span class="token directive"><span class="token keyword">listen</span>   <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">root</span>    /home/nginx/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">&#123;</span>
            <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</code></pre>

<h4 id="11-nginx代理设置"><a href="#11-nginx代理设置" class="headerlink" title="11. nginx代理设置"></a>11. nginx代理设置</h4><pre class="language-none"><code class="language-none"># 可以配置多个server块，用于监听不同域名和端口
server &#123;
    listen 80;
    server_name nginx服务器IP;
	
    location &#x2F; &#123;
        proxy_pass  http:&#x2F;&#x2F;192.168.210.190:8080;
    &#125;
    
    location &#x2F;myserver &#123;
        # 请求代理到指定的URL 代理后地址为 http:&#x2F;&#x2F;localhost:10010&#x2F;myserver
        proxy_pass http:&#x2F;&#x2F;localhost:10010;
        # 允许传递请求体数据给代理服务器
        proxy_pass_request_body on;
        # 设置请求头部 Content-Type 字段 application&#x2F;json 或者 multipart&#x2F;form-data
        proxy_set_header Content-Type &quot;application&#x2F;json&quot;;
        # 设置请求头部 host 字段（可选）
        proxy_set_header Host $host;
        # 用于传递客户端的真实IP地址给代理服务器（可选）
        proxy_set_header X-Real-IP $remote_addr;
    &#125;
&#125;</code></pre>

<h2 id="gitLab"><a href="#gitLab" class="headerlink" title="gitLab"></a>gitLab</h2><h3 id="1-拉取镜像-1"><a href="#1-拉取镜像-1" class="headerlink" title="1. 拉取镜像"></a>1. 拉取镜像</h3><pre class="language-none"><code class="language-none">docker pull gitlab&#x2F;gitlab-ce</code></pre>

<h3 id="2-创建容器"><a href="#2-创建容器" class="headerlink" title="2. 创建容器"></a>2. 创建容器</h3><pre class="language-none"><code class="language-none">docker run -d -p 4430:443 -p 9527:80 -p 222:22 --name gitlab --restart always -v &#x2F;home&#x2F;gitlab&#x2F;config:&#x2F;etc&#x2F;gitlab -v &#x2F;home&#x2F;gitlab&#x2F;logs:&#x2F;var&#x2F;log&#x2F;gitlab -v &#x2F;home&#x2F;gitlab&#x2F;data:&#x2F;var&#x2F;opt&#x2F;gitlab gitlab&#x2F;gitlab-ce</code></pre>

<h3 id="3-修改配置"><a href="#3-修改配置" class="headerlink" title="3. 修改配置"></a>3. 修改配置</h3><pre class="language-none"><code class="language-none"># 配置http协议所使用的访问地址,不加端口号默认为80,由于修改端口为9527，则nginx监听的端口为9527（原本是宿主机访问的是9527 &#x3D;&gt; 80，而此时nginx的的端口不再是80而是9527，因此需要把容器内nginx的监听端口改为80）
external_url &#39;http:&#x2F;&#x2F;192.168.126.128:9527&#39;
# 修改nginx监听端口
nginx[&#39;listen_port&#39;]&#x3D;80
# 配置ssh协议所使用的访问地址和端口
gitlab_rails[&#39;gitlab_ssh_host&#39;] &#x3D; &#39;192.168.126.128&#39;
gitlab_rails[&#39;gitlab_shell_ssh_port&#39;] &#x3D; 222 # 此端口是run时22端口映射的222端口
# 重启服务生效</code></pre>

<h3 id="4-初始化密码"><a href="#4-初始化密码" class="headerlink" title="4. 初始化密码"></a>4. 初始化密码</h3><pre class="language-none"><code class="language-none"># 进入容器
docker exec -it gitlab &#x2F;bin&#x2F;bash
# 进入控制台
gitlab-rails console
# 查找用户
user &#x3D; User.where(id: 1).first
# 设置密码
user.password &#x3D; &#39;new password&#39;
# 保存设置
user.save!
# 退出并重启容器
docker restart gitlab</code></pre>

<h3 id="5-提交现有项目"><a href="#5-提交现有项目" class="headerlink" title="5. 提交现有项目"></a>5. 提交现有项目</h3><pre class="language-none"><code class="language-none"># 初始化git仓库
git init
# 添加远程仓库地址
git remote add origin http:&#x2F;&#x2F;192.168.126.128:9527&#x2F;frontend&#x2F;vue2.git
# 提交代码文件
git add .
git commit -m &#39;初始化仓库&#39;
# 推送项目
git push -u origin master</code></pre>

<h3 id="6-删除项目后页面仍然存在"><a href="#6-删除项目后页面仍然存在" class="headerlink" title="6. 删除项目后页面仍然存在"></a>6. 删除项目后页面仍然存在</h3><pre class="language-none"><code class="language-none">docker exec -it gitlab &#x2F;bin&#x2F;bash
gitlab-rake gitlab:features:disable_rugged</code></pre>

<h2 id="gitlab-runner"><a href="#gitlab-runner" class="headerlink" title="gitlab-runner"></a>gitlab-runner</h2><h3 id="1-拉取镜像-2"><a href="#1-拉取镜像-2" class="headerlink" title="1. 拉取镜像"></a>1. 拉取镜像</h3><pre class="language-none"><code class="language-none">docker pull gitlab&#x2F;gitlab-runner:latest</code></pre>

<h3 id="2-创建容器-1"><a href="#2-创建容器-1" class="headerlink" title="2. 创建容器"></a>2. 创建容器</h3><pre class="language-none"><code class="language-none">docker run -d --name gitlab-runner --restart always \
  -v &#x2F;srv&#x2F;gitlab-runner&#x2F;config:&#x2F;etc&#x2F;gitlab-runner \
  -v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock \
  gitlab&#x2F;gitlab-runner:latest</code></pre>

<h3 id="3-注册runner"><a href="#3-注册runner" class="headerlink" title="3. 注册runner"></a>3. 注册runner</h3><pre class="language-none"><code class="language-none"># token在菜单 &#x3D;&gt; 管理员 &#x3D;&gt; runner 中获取
# url为gitlab访问地址（前提是按上面配置好gitlab）

docker run --rm -v &#x2F;srv&#x2F;gitlab-runner&#x2F;config:&#x2F;etc&#x2F;gitlab-runner gitlab&#x2F;gitlab-runner register \
  --non-interactive \
  --executor &quot;docker&quot; \
  --docker-image alpine:latest \
  --url &quot;http:&#x2F;&#x2F;192.168.126.128:9527&quot; \
  --registration-token &quot;qAjoLMTw7hhRxu6QC9M3&quot; \
  --description &quot;first-register-runner&quot; \
  --tag-list &quot;test-cicd,dockercicd&quot; \
  --run-untagged&#x3D;&quot;true&quot; \
  --locked&#x3D;&quot;false&quot; \
  --access-level&#x3D;&quot;not_protected&quot;</code></pre>

<h3 id="4-配置gitlab-runner-映射地址"><a href="#4-配置gitlab-runner-映射地址" class="headerlink" title="4. 配置gitlab-runner 映射地址"></a>4. 配置gitlab-runner 映射地址</h3><pre class="language-none"><code class="language-none">vi &#x2F;srv&#x2F;gitlab-runner&#x2F;config&#x2F;config.toml
# 宿主路径：容器路径 rw：同步读写
volumes &#x3D; [&quot;&#x2F;cache&quot;,&quot;&#x2F;home&#x2F;nginx&#x2F;html:&#x2F;home&#x2F;test:rw&quot;]</code></pre>

<h5 id="完整配置文件"><a href="#完整配置文件" class="headerlink" title="完整配置文件"></a><strong>完整配置文件</strong></h5><pre class="language-none"><code class="language-none">concurrent &#x3D; 1
check_interval &#x3D; 0

[session_server]
  session_timeout &#x3D; 1800

[[runners]]
  name &#x3D; &quot;first-register-runner&quot;
  url &#x3D; &quot;http:&#x2F;&#x2F;172.17.0.2&quot;
  token &#x3D; &quot;983DTfBkqJ-WcT5gx5Fa&quot;
  executor &#x3D; &quot;docker&quot;
  [runners.custom_build_dir]
  [runners.cache]
    [runners.cache.s3]
    [runners.cache.gcs]
    [runners.cache.azure]
  [runners.docker]
    tls_verify &#x3D; false
    image &#x3D; &quot;alpine:latest&quot;
    privileged &#x3D; false
    disable_entrypoint_overwrite &#x3D; false
    oom_kill_disable &#x3D; false
    disable_cache &#x3D; false
    volumes &#x3D; [&quot;&#x2F;cache&quot;]
    shm_size &#x3D; 0

[[runners]]
  name &#x3D; &quot;first-register-runner&quot;
  url &#x3D; &quot;http:&#x2F;&#x2F;192.168.126.128:9527&quot;
  token &#x3D; &quot;FVSDTGZ-y1d9buyEz7j9&quot;
  executor &#x3D; &quot;docker&quot;
  [runners.custom_build_dir]
  [runners.cache]
    [runners.cache.s3]
    [runners.cache.gcs]
    [runners.cache.azure]
  [runners.docker]
    tls_verify &#x3D; false
    image &#x3D; &quot;alpine:latest&quot;
    privileged &#x3D; false
    disable_entrypoint_overwrite &#x3D; false
    oom_kill_disable &#x3D; false
    disable_cache &#x3D; false
    volumes &#x3D; [&quot;&#x2F;cache&quot;,&quot;&#x2F;home&#x2F;nginx&#x2F;html:&#x2F;home&#x2F;test:rw&quot;]
    shm_size &#x3D; 0
</code></pre>

<h3 id="5-gitlab-ci-yml-文件配置"><a href="#5-gitlab-ci-yml-文件配置" class="headerlink" title="5. .gitlab-ci.yml 文件配置"></a>5. .gitlab-ci.yml 文件配置</h3><pre class="language-none"><code class="language-none"># .gitlab-ci.yml
image: node:alpine

stages:
  - install
  - build
  - deploy
before_script:
  - mkdir -p &#x2F;home&#x2F;test

cache:
  key: vue-test
  paths:
    - node_modules
    - dist

install:
  stage: install
  script:
    - npm config set registry https:&#x2F;&#x2F;registry.npm.taobao.org
    - npm install
  only:
    - master

build:
  stage: build
  script:
    - npm run build
  only:
    - master

deploy:
  stage: deploy
  script:
    - rm -rf &#x2F;home&#x2F;test&#x2F;*
    - cp -r dist&#x2F;* &#x2F;home&#x2F;test
  only:
    - master
  when: manual

</code></pre>

</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">觉得不错，就打赏吧.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/soxio/imglib@master/hexo/qqpay.png"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/soxio/imglib@master/hexo/qqpay.png" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/soxio/imglib@master/hexo/wechat.png"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/soxio/imglib@master/hexo/wechat.png" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>soxio</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://ajax404.tk/2023/06/22/%E5%89%8D%E7%AB%AF%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/" title="前端自动化部署">https://ajax404.tk/2023/06/22/%E5%89%8D%E7%AB%AF%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2023/10/09/vuex%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" rel="prev" title="vuex基本使用"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">vuex基本使用</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2023/06/22/VMware%E5%9B%BA%E5%AE%9AIP%E5%9C%B0%E5%9D%80/" rel="next" title="VMware固定IP地址"><span class="post-nav-text">VMware固定IP地址</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>如果发现文章有问题，欢迎发表评论一起讨论。</span><br></div><div id="waline"></div><script>Yun.utils.getScript("https://cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js", () => {
  const walineConfig = {"enable":true,"serverURL":"https://blog-api-8z15ablfw-soxio.vercel.app/","comment":true,"visitor":true,"avatarCDN":"https://cdn.v2ex.com/gravatar/","placeholder":"填写邮箱，可以收到回复通知哦～","requiredFields":["nick"],"el":"#waline","lang":"zh-CN"}
  walineConfig.path = "/2023/06/22/%E5%89%8D%E7%AB%AF%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/"
  new Waline(walineConfig)
}, window.Waline);</script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2021 – 2023 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> soxio</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v6.1.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.6.2</span></div><div class="live_time"><span>本博客已萌萌哒地运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2021-08-08T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div id="local-search-result"></div></div><div class="aplayer no-destroy" id="aplayer" data-id="6981128006" data-server="netease" data-type="playlist" data-fixed="true" data-theme="#0078E7" data-loop="all" data-order="list" data-preload="auto" data-volume="0.7" data-mutex data-lrctype="0" data-listmaxheight="340px" data-storagename="metingjs"></div></div></body></html>